###### resource
- [email regex confirmation: ](https://rubular.com/)
- [gravatar: global profile](https://en.gravatar.com/)
###### continuously develop after release as product
- (1) Suppose the website has released and after that new features continuously developed and released, in that case, we create branches in git, after test, merge branch to master.
```
git branch -b feature-new
git checkout feature-new
git branch
```

- (2) create table
```
rails generate migrate create_users
// open migrate file add columns
rails db:migrate //table is added to schema file
```
- (3) create model User.rb under app/model folder
- (4) run 'rails console' ('rails c'), add some data, exit
- (5) git commit to the branch
```
git add -A
git commit -m "comments"
```
- (6) merge branch
```
git checkout master
git merge feature-new
```
- (7) delete the branch
```
git branch -d feature-new
git branch -D feature-new //to delete a branch not merged to master
```

- (8) repeat above steps to craete new features.
- Some useful commands in rails console
```
>reload!
>user = User.new(usernmame: "a", email: "aa@bb.cc") //violate the validation rule
>user.valid? //->false
>user.errors.full_messages //print out errors
```
[Validate for rails:](https://guides.rubyonrails.org/active_record_validations.html)
[A tester to test email regex validation](https://rubular.com/)

###### association: one-to-many
- user : 1<->* : articles, 
In user.rb, add:  
```
has_many :articles
```
In article.rb, add: 
```
belongs_to :user
```
- run "rails c" 
```
>article = Article.first
>user.articles << article
>user.article
>article.user
```

###### Add bcrypt feature
- enable gem bcrypt in gemfile
```
gem 'bcrypt', '~> 3.1.7'
```
- run "bundle install"
- add "add_secure_password" in user.rb
- run "rails generate migration add_password_digest_to_users"
- open new created migration file, add: 
```
class AddPasswordDigestToUsers < ActiveRecord::Migration[6.0]
  def change
    add_column :users, :password_digest, :string
  end
end
```
- run "rails db:migrate"
- run "rails c", check "User.all", confirm password_digest column is generated.
```
BCrypt::Password.create("password123") //check it is converted to hash pwd
user=User.first
user.password="password123"
user.save //check password is converted to hash automatically
user.authenticate("wrongpassword") //check returned false
user.authenticate("password") //check returned user object
```

###### build signup page
- if you want to have your own route not generated by "rails routs", use below code to config in routes.rb 
```
#resources :users, only: [:new, :create]
get 'signup', to: 'users#new'
```
- the reason get error like: undefined method `users_path', it's caused by no definition of create in routes.rb, so add as below:  
```
get 'signup', to: 'users#new'
post 'users', to: 'users#create'
```
or use 
```
resources :users, except: [:new]
```

###### add edit page
All just like edit article page only pay attention below 2 points
- (1) To find out edit routes, use "|" 
```
rails routes --expanded | grep edit
```
- (2) When use the same html with signup page, could change submit button to below:
```_form.html.erb
<%= f.submit(@user.new_record? ? "Sign up" : "Update account", class: "btn btn-outline-light btn-lg") %>
```

###### add user profile and show related articles
- (1) Use gravatar to upload profile image and reuse it.
[Implement API doc:](https://en.gravatar.com/site/implement/images/ruby/)
- (2) In app/helpers/application_helper.rb add below code:
```
  def gravatar_for(user, options = {size:80})
    email_address = user.email.downcase
    hash = Digest::MD5.hexdigest(email_address)
    size = options[:size]
    garavatar_url = "https://www.gravatar.com/avatar/#{hash}?s=#{size}"
    image_tag(garavatar_url, alt:user.username, class: "rounded shadow mx-auto d-block")
  end
```
- (3) move articles list out to _article.html.erb, and in controller, add below source code, to filter out all the related articles:  
```
 @articles = @user.articles
```




